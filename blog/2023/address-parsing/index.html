<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> a post with code | You R. Name </title> <meta name="author" content="You R. Name"> <meta name="description" content="Parsing raw Vietnamese address data"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://marcusle02.github.io/blog/2023/address-parsing/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">You </span> R.  Name </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">a post with code</h1> <p class="post-meta"> July 30, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/formatting"> <i class="fa-solid fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/sample-posts"> <i class="fa-solid fa-tag fa-sm"></i> sample-posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>The accuracy and standardization of address data is critical for businesses, particularly in the e-commerce industry. Poorly parsed addresses can lead to slower delivery times, increased package returns, and unhappy customers. For data analysts, transforming raw address data into a standardized format can be a complex and daunting task, with even minor errors potentially having significant financial implications for the company.</p> <p>The goal of this article is to discuss the unique challenges posed by unstructured Vietnamese address data and to present a practical approach for extracting key information such as provinces, districts, and wards from these addresses. By exploring the characteristics of this data and sharing my own methodology, I hope to provide useful insights and strategies for addressing this common data analytics challenge.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: an unstructured string of Vietnamese address line
Output: province name, district name, and ward name
</code></pre></div></div> <h3>Administrative unit structure of Vietnam</h3> <p>Vietnam is divided into administrative units at three main levels: provinces/municipalities (both referred as provinces), districts/cities (both referred as districts), communes/wards/townships (all referred as wards), and villages/hamlets. At the top of the hierarchy are a combined of 63 provinces and municipalities, which are further divided into districts and cities. Rural districts are then broken down into communes and townships, while urban districts and cities are broken down into wards and communes. It is important to note that there are numeric districts and wards (Quận 7, Phường 11) that need to be considered in choosing the parsing method.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/9-480.webp 480w,/assets/img/9-800.webp 800w,/assets/img/9-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Vietnamese unit structure </div> <p>While there are further subdivisions into villages and hamlets, they are rarely used in addresses and official information about them could not be found. Therefore, they will not be included in this post. Additionally, this parsing project will not delve into deeper details such as street and alley names or specific places (e.g., Aeon Mall Hà Đông, Bến Nhà Rồng) as there is not enough data available to collect.</p> <h3>Understanding Vietnamese address writing</h3> <p>The Vietnamese alphabet consists of 29 letters, with four diacritics used in seven letters: ă, â, ê, ô, ơ, ư, and đ. An additional five diacritics indicate tone, such as à, á, ả, ã, and ạ. This makes the Vietnamese script distinct from other Latin writing systems. Additional details about these diacritics can be found at this <a href="https://vietnamesetypography.com/diacritical-details/" target="_blank" rel="external nofollow noopener">link</a>.</p> <p>Now, let’s take a look at a few examples of written address:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fulbright University Vietnam, 105 đường Tôn Dật Tiên, Phường Tân Phú, Quận 7, Thành phố Hồ Chí Minh
// Fulbright University Vietnam, 105 Ton Dat Tien Street, Tan Phu Ward, District 7, Ho Chi Minh City
</code></pre></div></div> <p>This is a clean example, all administrative units are written correctly, and they are also marked with a unit-defined word like Ward or District.</p> <p>In reality, we are more likely to see something like this:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fulbright University Vietnam, 105 Tôn Dật Tiên, Tân Phú, Q7, TP.HCM
// Fulbright University Vietnam, 105 Ton Dat Tien, Tan Phu, D7, HCMC
</code></pre></div></div> <p>Administrative units are often abbreviated or omitted in addresses. Vietnamese readers can usually understand what the unit refers to, even if it’s not spelled out completely. In the above example, “Q” or “TP.” are used to refer to a district or city/municipality, and “Tân Phú” could be used instead of “Phường Tân Phú” (Tan Phu Ward). In some cases, the name of the province is also omitted, such as in Ho Chi Minh City, where readers can infer that the address is within the city without the need for “HCMC.”</p> <p>Similarly, if an address contains “TP. Cao Bằng” (Cao Bang City), it may not include the province name “tỉnh Cao Bằng” (Cao Bang Prov.), since it’s clear that it’s from Cao Bang and redundant to repeat it. However, determining the correct province based solely on the district name can be challenging, especially when two provinces share the same district name.</p> <p>Also, there are different diacritic positions of a word in Vietnamese that do not affect its meaning, such as:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Khánh Hoà -- Khánh Hòa
Thuỷ Nguyên -- Thủy Nguyên
</code></pre></div></div> <p>While Vietnamese readers can intuitively recognize these differences, the algorithm should be designed to handle common misspellings and incorrect diacritic placement using fuzzy string matching techniques.</p> <p>Finally, it’s important to note that many people can recognize Vietnamese addresses without diacritics, such as “Fulbright University Vietnam, 105 Ton Dat Tien, Tan Phu, Quan 7.” However, to prevent ambiguity caused by similar names, the algorithm should prioritize the use of diacritics and only consider diacritic-less units as a last resort when diacritic parsing fails.</p> <p>In light of these considerations, I propose the following algorithmic process to match Vietnamese addresses:</p> <p>Step 1: Parse the province name, followed by the district name and then the ward name using their full names.</p> <p>Step 2: Similar to Step 1, but allowing for 1 misspelling or incorrect diacritic placement.</p> <p>Step 3: Similar to Step 1, but using diacritic-less unit name.</p> <p>Step 4: Similar to Step 1, but using abbreviation unit name.</p> <p>Step 5: If the district and ward names are provided without the province name, parse them and refer to the province based on the known location of the district/ward.</p> <p>The order of the algorithmic process proposed is designed to minimize the possibility of conflicts caused by random occurrences. For instance, if the algorithm first parses using abbreviations (i.e. HN, HCM), they may appear in other parts of an address could mistakenly be interpreted as administrative units (i.e. Vinh city could be mistakenly parsed from Vinhomes). Thus, we must first attempt to parse with the most specific and accurate information and gradually move towards more general and ambiguous information.</p> <h3>The Dataset</h3> <p>The dataset includes 1000 records that reflect actual customer addresses for an e-commerce business. To protect customer privacy, I have randomized the street and alley numbers while preserving the raw structure of the addresses. This allows for accurate analysis of address formats and patterns.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/9-480.webp 480w,/assets/img/9-800.webp 800w,/assets/img/9-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption">Sample addresses</div> <p>In addition to the customer addresses, I used a modified version of the Vietnamese administrative unit data from the General Statistics Office of Vietnam. This data includes three files for provinces, districts, and wards, with each unit’s name, code, and an accompanying RegEx Name.</p> <p>You can download the whole data package in this <a href="https://www.kaggle.com/datasets/namngl/testaddressinput" target="_blank" rel="external nofollow noopener">link</a>.</p> <h3>The Approach</h3> <p>One common approach to parsing Vietnamese addresses is to use <strong>regular expressions</strong> (RegEx) to match patterns in the address string. Regular expressions are a powerful tool for pattern matching and can be used to extract information such as the province, district, and ward from an address.</p> <p>Regular expressions consist of a combination of characters and symbols that define a pattern. For example, to extract the numeric district, we can use the pattern:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NUMERIC_DISTRICT = "q" + "(uận)?" + "(uan)?" + "<span class="p">[</span><span class="nv">. ]*[1-9</span><span class="p">][</span><span class="ss">0-9</span><span class="p">]</span>?"
</code></pre></div></div> <p>Think about why this pattern works by checking out the <a href="https://www.w3schools.com/python/gloss_python_regex_metacharacters.asp" target="_blank" rel="external nofollow noopener">RegEx metacharacters</a>.</p> <table> <tbody> <tr> <td>These patterns can be used directly on Python or stored in a CSV files, as demonstrated by some occurences in the Regex Name column. For instance, the pattern “((BRVT)</td> <td>(Bà Rịa – Vũng Tàu)</td> <td>(Bà Rịa Vũng Tàu))” can match any of the three names to province Bà Rịa-Vũng Tàu.</td> </tr> </tbody> </table> <p>However, regular expressions may not always return a result, especially if the address string is incomplete or contains errors. In such cases, we can use fuzzy matching algorithms to match the address string to a database of known addresses or to other sources of information. The algorithm prioritizes lowest Levenshtein distance, which measures the number of insertions, deletions, or substitutions needed to transform one string into another.</p> <p>By combining regular expressions and fuzzy matching algorithms, we can develop a robust system for parsing Vietnamese addresses and extracting the relevant information.</p> <h3>Implementation &amp; issues</h3> <p>For a detailed look at the code, see this <a href="https://github.com/MarcusLe02/Data-Science/blob/main/vietnam_address_parsing/vietnamese-address-parser.ipynb" target="_blank" rel="external nofollow noopener">link</a>.</p> <p>After completing the parsing steps, we should have the sample results as follows:</p> <h1 id="sample-result-image">Sample result image</h1> <p>However, there are two challenges that need to be addressed in future work. One of the main issues is that identifying abbreviations and alternative names for administrative units is a manual process, and so far, we have only covered names for Hanoi and Ho Chi Minh City. With knowledge of all other provinces, this issue can be resolved permanently.</p> <p>An additional issue arises when the algorithm matches a province name to a substring in the address that refers to something entirely different. For example, consider the below address line:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"502/26b huỳnh tấn phát; phường bình thuận; q7", parsed as Bình Thuận province
</code></pre></div></div> <p>This happens because the address line omits the actual province (HCMC), and the algorithm matches the only province-like instance “bình thuận” before attempting to match “q7” (District 7) to HCMC. To address this, we can introduce additional hierarchy conditions into the parsing process to ensure that the identified administrative unit is indeed the correct one. However, this approach is out of scope for this post and would be discuss in the future work.</p> <p>That’s all for the day. Vietnamese addresses may be unstructured and difficult to parse, but don’t worry, it’s not as bad as trying to untangle a plate of bun cha with forks. With a little patience and the right approach, you can turn those jumbled addresses into beautifully structured data, and avoid ending up with a tangled mess on your plate (or in your dataset!).</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/openpyxl/">a post with code</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/images/">Reinforcement Learning explained: theory</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/365ds/">a post with code</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/finance1/">An Excel template of Personal Finance for college students (Part 1)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/distill/">a distill-style blog post</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 You R. Name. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?7254ae07fe9cc5f3a10843e1c0817c9c" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>