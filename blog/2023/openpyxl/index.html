<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> a post with code | You R. Name </title> <meta name="author" content="You R. Name"> <meta name="description" content="A Walkthrough into automating Excel reports with openpyxl"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://marcusle02.github.io/blog/2023/openpyxl/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">You </span> R.  Name </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">a post with code</h1> <p class="post-meta"> August 18, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/formatting"> <i class="fa-solid fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/sample-posts"> <i class="fa-solid fa-tag fa-sm"></i> sample-posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Oh, Excel reporting! The mere thought of it sends chills down my spine. I can hear my colleague’s voice in my head saying, “Excel reporting is a pain, a real pain!” And let’s face it, no matter how fancy tools we use, we always end up back in Excel. Why? Because everyone knows how to use it. But at what cost? Endless hours of scrolling, applying formulas, and scrolling again. It’s like being trapped in a never-ending maze of cells, with no escape in sight. Even if you find the way out, there is still a repetitive work of updating 20 Excel charts for the weekly report waiting.</p> <p>With that being said, there are benefits with Excel charts. They are highly customizable and allow for easy creation of visuals and add-ons to highlight observations that support findings. They are also often seamlessly integrated into other Microsoft Office suite, making them an essential part of many slide decks and reports on a regular basis.</p> <p>Taking into account the laborious yet accessible nature of manual Excel reporting, I attempted to automate the process using Python library openpyxl. We’ll walk through each step of the process, from accessing and manipulating data to generating charts. By the end of this post, you’ll have a solid understanding of how to streamline your Excel reporting workflow, as well as its pros and cons.</p> <h3>Problem statement</h3> <p>Imagine you are a Data Analyst who has received a real-time Excel file containing all sales orders from the Data Engineer team. Your job is to create the weekly Sales Report using PowerPoint and to create the necessary charts from the raw data to put in the slide deck.</p> <p>The manual process of creating these charts is a daunting task that requires the following steps:</p> <ul> <li>Extract and transform raw data: Format data types, add extra columns, and apply formulas for better understanding and usability.</li> <li>Create pivot tables: Aggregate raw data to facilitate improved visualization and analysis.</li> <li>Create charts from pivot tables: Generate charts to enhance the visualization of data and extract insights.</li> <li>Format charts: Ensure visually appealing and clear representation of insights by formatting charts.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/9-480.webp 480w,/assets/img/9-800.webp 800w,/assets/img/9-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption">Sample pivot excel table</div> <p>This process can be time-consuming and error-prone, especially when dealing with large datasets. Let’s see if we automate this process using Python and openpyxl library, can we save time and improve the accuracy of our reports.</p> <p>I would use the sample sales data from Kaggle for the Python implementation, but you could choose any dataset you like to follow.</p> <h3>Implementation</h3> <p>Import libraries</p> <p>We’ll use the following libraries:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">openpyxl</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">openpyxl.chart</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">openpyxl.styles</span> <span class="kn">import</span> <span class="n">Font</span>
</code></pre></div></div> <p>Pandas will be used to read the Excel file, write formulas, create pivot tables, and write to a single Excel file. Openpyxl will be used to create charts and format the spreadsheet, and datetime will be used to save the report as the working date.</p> <p>Read Excel file &amp; add formulas Use the following code to read the necessary columns from the Excel file:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">excel_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_excel</span><span class="p">(</span><span class="sh">'</span><span class="s">sales_data_sample.xlsx</span><span class="sh">'</span><span class="p">)</span>
<span class="n">excel_df</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[[</span><span class="sh">'</span><span class="s">QUANTITYORDERED</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PRICEEACH</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ORDERDATE</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PRODUCTLINE</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PHONE</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">COUNTRY</span><span class="sh">'</span><span class="p">]]</span>
</code></pre></div></div> <h1 id="image-for-current-excel_df">image for current excel_df</h1> <p>You might notice that each record only contains the unit price and its quantity, thus we need to add a column to calculate the total price of the order. Also, the data frame does not recognize the order date as a datetime data type, then we need to manipulate it a bit:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">TOTALPRICE</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">QUANTITYORDERED</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">PRICEEACH</span><span class="sh">'</span><span class="p">]</span>
<span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">ORDERDATE</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">ORDERDATE</span><span class="sh">'</span><span class="p">])</span>
<span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">MONTH_ID</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">ORDERDATE</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">month</span>
<span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">YEAR_ID</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[</span><span class="sh">'</span><span class="s">ORDERDATE</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">year</span>
</code></pre></div></div> <p>In Excel, the process of creating formula columns is more cumbersome as we need to add a new column, remember the cells to reference the formula on, and copy to the whole column. In Python, we can do it intuitively by using the field names in the calculation.</p> <p>Creating pivot tables</p> <p>We can create pivot tables easily with the df.pivot_tables() function. Here are some examples of pivot tables that I use:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yearly_sales</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">YEAR_ID</span><span class="sh">'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">'</span><span class="s">TOTALPRICE</span><span class="sh">'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ytd_sales_by_country</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[</span><span class="n">excel_df</span><span class="p">.</span><span class="n">YEAR_ID</span> <span class="o">==</span> <span class="n">excel_df</span><span class="p">.</span><span class="n">YEAR_ID</span><span class="p">.</span><span class="nf">max</span><span class="p">()].</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">COUNTRY</span><span class="sh">'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">YEAR_ID</span><span class="sh">'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">'</span><span class="s">TOTALPRICE</span><span class="sh">'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ytd_monthly_orders</span> <span class="o">=</span> <span class="n">excel_df</span><span class="p">[</span><span class="n">excel_df</span><span class="p">.</span><span class="n">YEAR_ID</span> <span class="o">==</span> <span class="n">excel_df</span><span class="p">.</span><span class="n">YEAR_ID</span><span class="p">.</span><span class="nf">max</span><span class="p">()].</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">MONTH_ID</span><span class="sh">'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">'</span><span class="s">PHONE</span><span class="sh">'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <p>There are a few differences when using pivot tables in Python and Excel: the index parameter is used instead of rows in Excel, and the filter must be applied before using the pivot table. This makes the filter harder to use than in Excel, but it allows filtering with more complex conditions.</p> <p>Exporting pivot tables to Excel file After creating the pivot tables, we can save them as sheets in an Excel file with the ExcelWriter function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">today</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%d%m%y</span><span class="sh">'</span><span class="p">)</span>

<span class="k">with</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Report_</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s">.xlsx</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
    <span class="n">yearly_sales</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Yearly Sales</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ytd_sales_by_country</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Yearly Sales</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ytd_monthly_orders</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">YTD Monthly Orders</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Now the Excel file is exported in the same folder your Python script is located, and it is named with the creation date like Report_180322, which means the file is created on 18 March, 2022.</p> <p>Manipulate Excel file with openpyxl We will use the openpyxl library to create charts from the pivot tables, the documents of which could be found <a href="https://openpyxl.readthedocs.io/en/stable/index.html" target="_blank" rel="external nofollow noopener">here</a>.</p> <p>Create row and column reference</p> <p>To ensure the code continues to work with any amount of data, we need to determine the minimum and maximum active column and row of each pivot table. We must first load the workbook with load_workbook() and locate the sheet we want to work with using wb[‘sheet_name’]. Then, we can get the data location to create charts from.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wb</span> <span class="o">=</span> <span class="nf">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">wb_filename</span><span class="p">)</span> <span class="c1"># Load workbook
</span><span class="n">sheet</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="c1"># Locate sheet
</span>
<span class="c1"># Get pivot table range
</span><span class="n">min_column</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">min_column</span>
<span class="n">max_column</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">max_column</span>
<span class="n">min_row</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">min_row</span>
<span class="n">max_row</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">max_row</span>

<span class="n">chart</span> <span class="o">=</span> <span class="nc">BarChart</span><span class="p">()</span> <span class="c1"># Initialize bar chart
</span><span class="n">data</span> <span class="o">=</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span>
                        <span class="n">min_col</span><span class="o">=</span><span class="n">min_column</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_col</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
                        <span class="n">min_row</span><span class="o">=</span><span class="n">min_row</span><span class="p">,</span>
                        <span class="n">max_row</span><span class="o">=</span><span class="n">max_row</span><span class="p">)</span> <span class="c1"># Including headers
</span><span class="n">categories</span> <span class="o">=</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span>
                        <span class="n">min_col</span><span class="o">=</span><span class="n">min_column</span><span class="p">,</span>
                        <span class="n">max_col</span><span class="o">=</span><span class="n">min_column</span><span class="p">,</span>
                        <span class="n">min_row</span><span class="o">=</span><span class="n">min_row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_row</span><span class="o">=</span><span class="n">max_row</span><span class="p">)</span> <span class="c1"># Not including headers
</span><span class="n">chart</span><span class="p">.</span><span class="nf">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># Adding data to charts
</span><span class="n">chart</span><span class="p">.</span><span class="nf">set_categories</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
</code></pre></div></div> <p>The above code block would create a bar chart for the pivot table in the specified sheet.</p> <p>Styling options for Excel charts In addition to creating charts, openpyxl also provides options for styling the charts to make them more visually appealing and understandable. Here are some examples of chart styling options:</p> <ol> <li>Set chart title: Use <code>chart.title</code> attribute to set the title of the chart.</li> <li>Set chart legend: Use <code>chart.legend</code> attribute to set the legend position of the chart.</li> <li>Set chart axis labels: Use <code>chart.x_axis.title</code> and <code>chart.y_axis.title</code> attributes to set the axis labels of the chart.</li> <li>Set series colors: Use <code>chart.series[i].graphicalProperties.solidFill</code> attribute to set the color of the i-th series of the chart.</li> <li>Set chart axis scale: Use <code>chart.x_axis.scaling.min/max</code> and <code>chart.y_axis.scaling.min/max</code> attributes to set the axis scale of the chart.</li> </ol> <p>These are only a few examples of the many styling options available for Excel charts in openpyxl. With openpyxl, you can customize various chart features, such as font styles, gridlines, borders, line styles, and more. However, I will only focus on a few styles in the code.</p> <p>Master function for creating charts To streamline the process of creating charts and referencing data, we can create a master function that accepts optional parameters for styling. This allows for easier creation of multiple charts with consistent data references from pivot tables. Check the function template below for an example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_chart</span><span class="p">(</span><span class="n">wb_filename</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">,</span> <span class="n">style_1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style_2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="p">...):</span>

        <span class="n">wb</span> <span class="o">=</span> <span class="nf">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">wb_filename</span><span class="p">)</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span>
        <span class="c1"># Get pivot table range
</span>        <span class="n">min_column</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">min_column</span>
        <span class="p">.</span><span class="bp">...</span>

        <span class="c1"># Dictionary for initializing chart type
</span>        <span class="n">CHART_DICT</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="nc">BarChart</span><span class="p">(),</span>
                      <span class="sh">'</span><span class="s">line</span><span class="sh">'</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="nc">LineChart</span><span class="p">(),</span>
                      <span class="sh">'</span><span class="s">pie</span><span class="sh">'</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="nc">PieChart</span><span class="p">(),</span> <span class="p">...}</span>
        <span class="n">chart</span> <span class="o">=</span> <span class="n">CHART_DICT</span><span class="p">[</span><span class="n">chart_type</span><span class="p">]()</span>

        <span class="c1"># Set styles if specified
</span>        <span class="k">if</span> <span class="n">style_1</span><span class="p">:</span>
                <span class="n">chart</span><span class="p">.</span><span class="n">style_1</span> <span class="o">=</span> <span class="n">style_1</span>
        <span class="bp">...</span>
                
        <span class="n">data</span> <span class="o">=</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">sheet</span><span class="p">,...)</span> <span class="c1"># including headers
</span>        <span class="n">categories</span> <span class="o">=</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">sheet</span><span class="p">,...)</span> <span class="c1"># not including headers
</span>        <span class="n">chart</span><span class="p">.</span><span class="nf">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">chart</span><span class="p">.</span><span class="nf">set_categories</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
        <span class="n">sheet</span><span class="p">.</span><span class="nf">add_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="sh">"</span><span class="s">A15</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># Chart placement
</span>
        <span class="n">wb</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">wb_filename</span><span class="p">)</span>
</code></pre></div></div> <p>After that, we could use this function to create charts, here is an example to create a stacked bar chart:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">create_chart</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Report_</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s">.xlsx</span><span class="sh">"</span><span class="p">,</span> <span class="n">sheet</span><span class="o">=</span><span class="sh">"</span><span class="s">YTD USA Monthly Sales</span><span class="sh">"</span><span class="p">,</span>
<span class="n">chart_type</span><span class="o">=</span><span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="sh">"</span><span class="s">col</span><span class="sh">"</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="sh">"</span><span class="s">stacked</span><span class="sh">"</span><span class="p">,</span>
<span class="n">chart_title</span><span class="o">=</span><span class="sh">"</span><span class="s">YTD USA Monthly Sales</span><span class="sh">"</span><span class="p">,</span> <span class="n">x_title</span><span class="o">=</span><span class="sh">"</span><span class="s">Month</span><span class="sh">"</span><span class="p">,</span>
<span class="n">y_title</span><span class="o">=</span><span class="sh">"</span><span class="s">Sales</span><span class="sh">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div></div> <h1 id="image-for-ytd-usa-monthly-sales">Image for YTD USA Monthly Sales</h1> <p>The above chart can still be improved by adjusting spacing between columns or using a different color scheme, but you got the idea of how it work. Don’t be intimidated by the styling code – take your time to explore and test each option to achieve the desired result. Testing the styling options back-and-forth can also help to fine-tune the chart and make it visually appealing.</p> <p>Using crontab to automate the report To automate the above process, we can use a tool called crontab. This tool allows us to schedule a script to run at specific intervals, such as every week at 8 AM, on Friday. We can write a script that generates charts using openpyxl, and then use crontab to run it automatically. This saves us time and ensures that our charts are always up-to-date. In this post, I would not cover the detailed steps of setting up a crontab job, but you can find a comprehensive guide <a href="https://ostechnix.com/a-beginners-guide-to-cron-jobs/" target="_blank" rel="external nofollow noopener">here</a>.</p> <h3>Takeaways</h3> <p>For the detailed code that I use in this project, check out this <a href="https://github.com/MarcusLe02/Data-Science/blob/main/excel_report_automation/excel-automation.ipynb" target="_blank" rel="external nofollow noopener">link</a>.</p> <p>To summarize, creating charts in Excel using openpyxl is a valuable technique for data visualization and reporting. It provides numerous filtering &amp; styling customization which allow you to create professional-looking charts. Additionally, creating a master function for chart creation can streamline the process and save time for repetitive tasks, making it an efficient way to create reports.</p> <p>On the other hand, there are also some drawbacks to using openpyxl for report creation. One downside is the steep learning curve to understand the syntax, especially if you want to create highly customized charts. Another potential issue is the compatibility of the charts in different versions, as openpyxl may not always generate charts that are compatible with older versions of Excel. Nevertheless, with some practice and experimentation, you can achieve great results and impress your colleagues or clients with professional-looking charts.</p> <p>In short, if you have a large amount of data and want to automate the Excel report generation process, openpyxl is a powerful tool that can save you time and effort in the long run.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/address-parsing/">a post with code</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/365ds/">a post with code</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/finance1/">An Excel template of Personal Finance for college students (Part 1)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/images/">Reinforcement Learning explained: theory</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/finance2/">An Excel template of Personal Finance for college students (Part 2)</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 You R. Name. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?7254ae07fe9cc5f3a10843e1c0817c9c" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>